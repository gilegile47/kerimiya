/*
 * Keremiya v5 Main JS
 */
jQuery(document).ready(function(a){function j(b,c){var d=a(c).parent();b?a(d).addClass("process").addClass("noselect"):a(d).removeClass("process").removeClass("noselect")}function k(b,c,d){var e=z("cvote_"+b),f={action:"keremiya_comment_vote",id:b,w:c,c:e};a.post(kL10n.ajax_url,f,function(c){if(1==c){var e=a(".count",d),f=a(e).text();f++,a(e).text(f),a(d).addClass("active"),y("cvote_"+b,b,360)}else{var g=c.split("|");s(g[0],g[1],g[2])}q(a(d))})}function n(a){var b="",c=480,d=380,e=screen.width/2-c/2,f=screen.height/2-d/2,g=encodeURIComponent(location.href),h=encodeURIComponent(document.title),i="toolbar=0,status=0,width="+c+",height="+d+",top="+f+",left="+e;return"fb"==a&&(b="http://www.facebook.com/sharer.php?u="+g+"&t="+h),"tw"==a&&(b="http://twitter.com/share?url="+g+"&text="+h),"gp"==a&&(b="https://plus.google.com/share?url="+g),window.open(b,"sharer",i),!1}function o(a){a&&(window.location.href=a)}function p(a){a.addClass("icon-spinner1").addClass("animate-spin")}function q(a){a.removeClass("icon-spinner1").removeClass("animate-spin")}function s(b,c,d){var e={modal:".modal",bg:".modal-bg",head:".modal-header",inner:".modal-inner",form:".modal-form"},f={id:".modal-message",header:".message-header",content:".message-content",footer:".message-footer",close:".message-close"};a(e.modal).hide(),a(e.head).hide(),a(e.form).hide(),a(e.modal).show(),a(""+e.bg+", "+f.close).click(function(){a(e.modal).hide()}),a(f.id).show(),a(f.header).html(b),a(f.content).html(c),a(f.footer).html(d),a(".show-modal").live("click",function(){return u(this),!1}),v(e.inner)}function u(b,c,d){var e={popup:d?d:a(b).attr("data-id"),is:c?c:a(b).attr("data-is"),modal:".modal",bg:".modal-bg",inner:".modal-inner",form:".modal-form",message:".modal-message",header:".modal-header"};a(e.modal).hide(),a(e.message).hide(),a("body").addClass("hidden"),e.is&&(a(e.form).hide(),a(e.is).show()),a(e.popup).show(),a(e.header).show().html(a(".header-logo").html()),a(e.bg).click(function(){e.is?a(e.is).hide():a(e.popup).hide(),a("body").removeClass("hidden")}),a(e.header).click(function(){return a(e.is).hide(),a("body").removeClass("hidden"),!1}),v(e.inner)}function v(b){var c=a(b).height(),d=c/2;a(b).css("margin-top","-"+d+"px")}function w(a,b,c){var d=document.getElementById(c),e=d.value,f=e.substring(d.selectionStart,d.selectionEnd),g=e.substring(0,d.selectionStart),h=e.substring(d.selectionEnd,e.length);d.value=g+"["+a+"]"+f+"[/"+a+"]"+h,d.focus()}function x(a){var b=1;return a=a.replace(/[\s]+/gim," "),a.replace(/(\s+)/g,function(a){b++}),0==a&&(b=0),b}function y(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e}function z(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""}function A(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function B(a){var b="",c=a.keremiya_action.value;return"register"==c&&(""==a.register_username.value?b=a.register_username:A(a.register_email.value)?a.register_email.value!=a.register_re_email.value?b=a.register_re_email:""==a.register_password.value&&(b=a.register_password):b=a.register_email),"login"==c&&(""==a.login_username.value?b=a.login_username:""==a.login_password.value&&(b=a.login_password)),"report"==c&&(A(a.report_email.value)?""==a.report_excerpt.value&&(b=a.report_excerpt):b=a.report_email),"comment"==c&&(""==a.comment.value?b=a.comment:""==a.author.value?b=a.author:A(a.email.value)||(b=a.email)),!b||(b.focus(),!1)}function E(b,c){var d=a(window).scrollTop();if(b<d){var e={contentHeight:a(c.contentID).outerHeight(!0),contentWidth:a(c.contentID).outerWidth()+a(c.contentID).offset().left,stickyHeight:a(c.stickyID).outerHeight(!0),stickyTop:a(c.stickyID).offset().top,stickyWidth:a(c.stickyID).outerWidth(),footerTop:a(c.footerID).offset().top};if(e.stickyHeight<e.contentHeight){a(c.stickyID).css({position:"fixed",top:c.offtop,left:a(c.stickyID).offset().left,width:e.stickyWidth});var f=e.footerTop-e.stickyHeight-c.offtop;if(f<d){var g=f-d+c.offtop;a(c.stickyID).css({top:g})}}}else a(c.stickyID).css({position:"static",top:"",left:"",width:""})}var b=!1;a(".loadnavi").click(function(){var c=a(this),d=parseInt(c.attr("data-paged"))+1,e=parseInt(c.attr("data-max")),f=c.attr("href"),g="keremiya-loadnavi-page-"+d,h=".film-content .list_items";if(!b)if(b=!0,d<=e){var i=d;j(!0,a(".loader",c)),a("."+g).load(f+" "+h,function(){a(".current",c).text(d),c.attr("data-paged",d),d++,f=f.replace(/\/page\/[0-9]*/,"/page/"+d),c.attr("href",f),a(".loadnavi").before('<div class="keremiya-loadnavi-page-'+d+'"></div>'),j(!1,a(".loader",c)),b=!1,i==e&&a(c).fadeOut()})}else a(c).fadeOut();return!1});var c=315,d="...",e=kL10n.more,f=kL10n.less,g=".excerpt";a(".more").each(function(){var b=a(this).html();if(b.length>c){var f=b.substr(0,c),g=b.substr(c,b.length-c),h=f+'<span class="moreelipses">'+d+'</span><span class="morecontent"><span>'+g+'</span>&nbsp;&nbsp;<a href="" class="morelink">'+e+"</a></span>";a(this).html(h)}}),a(".morelink").click(function(){return a(this).hasClass("less")?(a(this).removeClass("less"),a(g).removeClass("less"),a(this).html(e)):(a(this).addClass("less"),a(g).addClass("less"),a(this).html(f)),a(this).parent().prev().toggle(),a(this).prev().toggle(),!1});var h=!1;a(".modal-form form").submit(function(b){b.preventDefault();var c=a(this),d=B(this),e=!1;if(d&&!h){h=!0,j(!0,c);var f={action:"keremiya_user_action",form:c.serialize()};a.ajax({type:"post",url:kL10n.ajax_url,data:f,success:function(b){1==b?(o(a("#redirect-url",c).val()),e=!0):(a(".display-message",c).fadeIn(),a(".display-message",c).html(b))},complete:function(){e||(h=!1,j(!1,c),v(".modal-inner"))}})}});var i=!1;a(".popup form").submit(function(b){b.preventDefault();var c=a(this),d=B(this);if(d&&!i){i=!0,j(!0,c);var e={action:"keremiya_report",form:c.serialize()};a.ajax({type:"post",url:kL10n.ajax_url,data:e,dataType:"json",success:function(a){a.error?(i=!1,s(a.title,a.content,a.footer)):c.append('<div class="success">'+a.html+"</div>")},complete:function(){j(!1,c)}})}}),a("#commentform").submit(function(b){var d=(a(this),B(this));d?b.stopPropagation():b.preventDefault()}),a(".comment-vote").on("click",function(){p(a(this)),k(a(this).attr("data-id"),a(this).attr("data-type"),a(this))});var l=!1;a("#update-user").submit(function(b){b.preventDefault();var c=a(this);if(!l){l=!0,j(!0,c);var d={action:"keremiya_update_user",form:c.serialize()};a.ajax({type:"post",url:kL10n.ajax_url,data:d,success:function(b){a(".upd").html(b)},complete:function(){l=!1,j(!1,c)}})}});var m=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}();a(window).scroll(function(){a(this).scrollTop()>115&&window.innerWidth>959&&(a("#header").addClass("sticky"),m(function(){a("#header").addClass("animate")},10)),a(this).scrollTop()<115&&m(function(){a("#header").removeClass("animate"),m(function(){a("#header").removeClass("sticky"),window.innerWidth>959&&(a("#navbar").removeClass("sticky"),a(".menu-toogle").removeClass("active"))},5)},1)}),a(".keremiya-share").on("click",function(){n(a(this).attr("data-type"))}),a(".arg").on("click",function(b){o(a(".remove",this).data("url"))}),a("#note .remove").click(function(){a(this).parent().slideUp("fast")}),a(".archive-icons").click(function(){var b=".c-sidebar",c=".film-content";a(this).toggleClass("change"),a(b).toggleClass("show"),a(c).toggleClass("hide")}),a(".wide-button").on("click",function(){a(".single-content.video").toggleClass("wide-popup"),a("body").toggleClass("wide-popup")}),a(".menu-toogle").on("click",function(b){a(this).toggleClass("active"),a("#navbar").toggleClass("sticky"),b.stopPropagation()}),a(".search-toogle").on("click",function(b){a(this).toggleClass("active"),a(".header-search").toggleClass("active"),a("#s").focus(),b.stopPropagation()}),a(".user-my-account").live("click",function(b){a(this).toggleClass("active"),q(a(this).find("span")),b.stopPropagation()}),a(document).click(function(){a(".dropdown").removeClass("active")});var r=!1;a(".addto").live("click",function(){if(!r){r=!0;var b=a(this),c=b.data("is");if(2==c)var d=b.parent().parent().parent().attr("data-this"),e=b.attr("data-id"),f=b;else var d=b.attr("data-this"),e=b.attr("data-id"),f=b.find("span");p(f),jQuery.ajax({type:"post",url:kL10n.ajax_url,data:"action=keremiya_addto&this="+d+"&nonce="+kL10n.nonce+"&post_id="+e,dataType:"json",success:function(a){a.error?s(a.title,a.content,a.footer):1==c?(b.addClass("active"),b.removeClass("addto"),f.removeClass("icon-plus"),f.addClass("icon-ok")):2==c?b.parent().parent().hide():b.html(a.html)},complete:function(){r=!1,q(f)}})}return!1}),a(".comment-reply-login").on("click",function(){return u(this,"#popup","#login-form"),!1}),a(".show-modal").live("click",function(){return u(this),!1}),a(".action").each(function(){var b={d:null,f:!1,e:!1,b:250,c:100,a:10,i:a(".trigger",this).outerHeight(!0)+18,g:a(".trigger",this),h:a(".popup",this)};a([b.g.get(0)]).toggle(function(){b.h.removeClass("m-hide")},function(){b.h.addClass("m-hide")}),a([b.g.get(0),b.h.get(0)]).mouseover(function(){if(b.d&&clearTimeout(b.d),!b.e&&!b.f)return t=setTimeout(function(){t=null,b.e=!0,b.h.css({display:"block",top:""+b.i+"px"}).animate({top:"-="+b.a+"px",opacity:1},b.b,"swing",function(){b.e=!1,b.f=!0})},300),!1}).mouseout(function(){return b.d&&clearTimeout(b.d),clearTimeout(t),b.d=setTimeout(function(){b.d=null,b.h.animate({top:"-="+b.a+"px",opacity:0},b.b,"swing",function(){b.f=!1,b.h.removeClass("m-hide m-active"),b.h.css("display","none")})},b.c),!1})}),a("#action-parts").each(function(){var b=a(".active .part-name",this).text(),c=a(".active-part",this);c.html(b)}),a(".tabs").each(function(){a("li.tab",this).click(function(){a(".tabs li").removeClass("active"),a(this).addClass("active"),a(".wrap").hide();var b=a(this).attr("data-id");return a("#"+b).fadeIn("fast"),!1})}),a(".stars").each(function(){var b=a(this),c=".your-vote span",d=a("a",b);d.bind("mouseenter",function(b){a(this).addClass("tmp_fs").prevAll().addClass("tmp_fs"),a(this).nextAll().addClass("tmp_es")}),d.bind("mouseleave",function(b){a(this).removeClass("tmp_fs").prevAll().removeClass("tmp_fs"),a(this).nextAll().removeClass("tmp_es")});var e=!1;d.bind("click",function(f){var g=a(this).text(),h=a(this).parent().attr("data-id"),i=a(this).parent().attr("data-nonce");z("post_rate_"+h);return e||(e=!0,d.removeClass("fullStar"),a(this).addClass("fullStar").prevAll().addClass("fullStar"),a(c).html(g),j(!0,".vote"),jQuery.ajax({type:"post",url:kL10n.ajax_url,data:"action=keremiya_ratings&nonce="+i+"&rate="+g+"&post_id="+h,dataType:"json",success:function(e){if(e.error)d.removeClass("fullStar"),a(c).html(""),s(e.title,e.content,e.footer);else{a(".icon-star .average, .details .average").html(e.html),b.append('<div class="success">'+e.message+"</div>"),m(function(){a(".success",b).fadeOut("fast")},2e3);var f=a(".vote .total").text();f?(f++,a(".vote .total").html(f)):a(".details").html(e.message)}},complete:function(){e=!1,j(!1,".vote")}})),!1})}),a(".footer-sticky .close").on("click",function(){return a(".footer-sticky").hide(),!1}),window.innerWidth<959?a(".header-user").each(function(){var b=a(this).html();a(".navbar-content").prepend('<div class="menu-user">'+b+"</div>")}):(a(".tooltip-w").tipsy({live:!0,gravity:"w",opacity:.95}),a(".tooltip").tipsy({live:!0,gravity:"n",opacity:.95}),a(".tooltip-s").tipsy({live:!0,gravity:"s",opacity:.95}),a(".tooltip-sw").tipsy({live:!0,gravity:"sw",opacity:.95}),a(".existing_item").tipsy({className:"kepsy",kepsy:!0,fade:!1,html:!0,live:!0,opacity:.95,gravity:a.fn.tipsy.autoWE,title:function(){var b=a(this).find(".existing-details").html();return b}})),a(window).resize(function(){window.innerWidth>959?(a(".menu-user").hide(),a("#navbar").removeClass("sticky"),a(".menu-toogle").removeClass("active")):a(".menu-user").show()}),a(".c-sidebar").each(function(){var b=a(this).outerWidth();b<225&&a(this).addClass("full")}),a(".select-type").click(function(){var b=a(this).attr("data-open");return a(".select-type").removeClass("active"),a(".add-content form").hide(),a(".add-content #message").hide(),a(this).addClass("active"),a(b).slideDown(300,function(){a("html, body").animate({scrollTop:a(this).offset().top-80},200)}),!1}),a(".submit-content").click(function(){p(a(this))}),a(".KR-head button").click(function(){var b=a(this).attr("data-format"),c=a(this).parent().attr("data-area");w(b,b,c)}),a(".KR-textarea textarea").keyup(function(){var b=x(a(this).val()),c=a(this).closest(".KR-editor");a("#textarea-feedback span",c).html(b)});var C={stickyID:"#sticky-sidebar",contentID:".detail",footerID:"#footer",offtop:offtop?offtop:50};if(a(C.stickyID).length>0&&sticky_sidebar){var D=a(C.stickyID).offset().top-C.offtop;a(window).scroll(function(){window.innerWidth>959&&E(D,C)})}});